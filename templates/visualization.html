<!doctype html>
<html lang="en">
<head><meta charset="utf-8"><title>Visualization - BitShred</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head><body>
<nav class="navbar navbar-dark bg-dark sticky-top"><div class="container-fluid"><a class="navbar-brand" href='/'>BitShred</a></div></nav>
<div class="container my-4">
  <h2>Real-Time Visualization</h2>
  <div class="row">
    <div class="col-md-6"><canvas id="ingestChart"></canvas></div>
    <div class="col-md-6"><div id="speciesPie"></div></div>
  </div>
  <div class="mt-4"><h4>Counts</h4><ul id="counts"></ul></div>
</div>
<footer class="bg-dark text-white text-center p-3">Â© 2025 BitShred</footer>
<script>
async function fetchData(){
  const res = await fetch('/api/visualization_data');
  const data = await res.json();
  const labels = data.timeseries.map(x=>x.date);
  const values = data.timeseries.map(x=>x.count);
  const ctx = document.getElementById('ingestChart').getContext('2d');
  if(window._ingestChart) window._ingestChart.destroy();
  window._ingestChart = new Chart(ctx, {type:'line', data:{labels:labels, datasets:[{label:'Ingestions', data:values, borderColor:'#007bff', fill:false}]}, options:{responsive:true}});
  const species = Object.keys(data.species_counts||{});
  const counts = Object.values(data.species_counts||{});
  Plotly.newPlot('speciesPie',[{values:counts, labels:species, type:'pie'}],{title:'Species Distribution'});
  document.getElementById('counts').innerHTML = '<li>Ingestion: '+data.ingestion_count+'</li><li>Otolith: '+data.otolith_count+'</li><li>eDNA: '+data.edna_count+'</li>';
}
fetchData(); setInterval(fetchData, 10000);
</script>
</body></html>
